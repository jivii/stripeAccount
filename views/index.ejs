<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Onboarding with Express OAuth</title>
    <meta name="description" content="Onboarding with Express OAuth" />
    <base rel="stylesheet" type="text/css" href="css/normalize.css" />
    <base rel="stylesheet" type="text/css" href="css/global.css" />
    <script src="https://js.stripe.com/v3/"></script>
    <script>
    let elmButton = document.querySelector("#submit");

    if (elmButton) {
      elmButton.addEventListener(
        "click",
        e => {
          elmButton.setAttribute("disabled", "disabled");

          fetch("/get-oauth-link", {
            method: "GET",
            headers: {
              "Content-Type": "application/json"
            }
          })
            .then(response => response.json())
            .then(data => {
              if (data.url) {
                window.location = data.url;
              } else {
                elmButton.removeAttribute("disabled");
                elmButton.textContent = "<Something went wrong>";
                console.log("data", data);
              }
            });
        },
        false
      );
    }
    </script>
  </head>

  <body>
    <div class="sr-root">
      <div class="sr-main">
        <div class="sr-onboarding-summary onboarding-view">
          <h1>Onboard an Express account with OAuth</h1>
        </div>        
        <button id="submit"></button>
      </div>
    </div>
  </body>
</html>
